_G.MagmaNPCFarm = true

while _G.MagmaNPCFarm do
    -- Generate random X, Y, and Z coordinates for the platform
    -- (platform generation code goes here)

    -- Create the platform
    -- (platform creation code goes here)

    -- Fire the UpdateHaki remote
    -- (UpdateHaki remote firing code goes here)

    -- Fire the Retum remote
    -- (Retum remote firing code goes here)

    -- Teleport the player to the platform
    -- (player teleportation code goes here)

    -- Make the enemies invisible and remove decals and effects
    -- (enemy invisibility code goes here)

    -- Position and handle the enemies
    -- (enemy handling code goes here)

    -- Perform Magma actions
    local enemies = workspace.Enemies:GetChildren()
    local script = game:GetService("Players").LocalPlayer.Character.Powers.Magma
    local VTC = script.RemoteEvent.RemoteFunction:InvokeServer()

    for _, enemy in ipairs(enemies) do
        local humanoidRootPart = enemy:FindFirstChild("HumanoidRootPart")
        if humanoidRootPart then
            local npcPosition = humanoidRootPart.Position
            local magmaBallDirection = (npcPosition - script.Parent.Parent.Head.Position).Unit

            script.RemoteEvent:FireServer(VTC, "MagmaPower1", "StartCharging",
                CFrame.new(npcPosition, npcPosition + magmaBallDirection),
                workspace.IslandCaver.Stones.Stone,
                100
            )
            script.RemoteEvent:FireServer(VTC, "MagmaPower1", "StopCharging",
                CFrame.new(npcPosition, npcPosition + magmaBallDirection),
                workspace.IslandCaver.Stones.Stone,
                100
            )

            wait(0.5) -- Wait for 0.5 seconds before the next Magma ball action
        end
    end

    wait(0.09) -- Wait for the remaining time (0.1 - 0.01) before generating the next platform
end
